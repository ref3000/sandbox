<!DOCTYPE html>
<html lang="ja">
<head>
<title>L</title>
<meta name="viewport" content="width=320,user-scalable=no">
<style>
  html, body, div, span, button {
    margin: 0;
    padding: 0;
  }
  button {
    width: 50px;
    height: 50px;
    font-size: 12px;
    text-align: center;
    overflow-wrap: anywhere;
  }
  .b-container {
    display: flex;
    justify-content: space-around;
    margin-top: 8px;
  }
  .b-blue {
    background-color: #a0d8ef;
  }
  .b-green {
    background-color: #83b85d;
  }
  .b-red {
    background-color: #f69ea1;
  }
  .b-yellow {
    background-color: #dcd15f;
  }
  .b-c1 {
    background-color: #cccccc;
  }
  .b-c2 {
    background-color: #dddddd;
  }
  .b-c3 {
    background-color: #eeeeee;
  }
  .table-container {
            width: 100%;
            margin: 20px auto;
        }
  table {
    table-layout: fixed;
    width: 100%;
    margin-top: 8px;
    border-collapse: collapse;
    box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
    font-size: 12px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 12px 0 12px 0;
    text-align: center;
    /* word-wrap: break-word; */
  }
  th {
    background-color: #f2f2f2;
  }
  tr:nth-child(even) {
    background-color: #f9f9f9;
  }
  .replay {
    background-color: #a0d8ef;
  }
  .suica {
    background-color: #83b85d;
  }
  .suicaF {
    background-color: #83b85d;
  }
  .cherry {
    background-color: #f69ea1;
  }
  .cherryF {
    background-color: #f69ea1;
  }
  .chance {
    background-color: #dcd15f;
  }
</style>
</head>
<body>
<div>
  <button onclick="onReset()" class="b-c1">Reset</button>
</div>
<div class="b-container">
  <button onclick="onReplay()" class="b-blue">リプ</button>
  <button onclick="onCherry()" class="b-red">弱チ</button>
  <button onclick="onSuica()" class="b-green">弱ス</button>
  <button onclick="onChance()" class="b-yellow">チャ</button>
  <button onclick="onSuicaF()" class="b-green">強ス</button>
  <button onclick="onCherryF()" class="b-red">強チ</button>
</div>
<div class="b-container">
  <button onclick="reset()" class="b-c1">地獄</button>
  <button onclick="reset()" class="b-c1">地or通</button>
  <button onclick="reset()" class="b-c2">通常</button>
  <button onclick="reset()" class="b-c2">通or天</button>
  <button onclick="reset()" class="b-c3">天国</button>
  <button onclick="reset()" class="b-c3">本前兆</button>
</div>
<div class="table-container">
  <table id="table"></table>
</div>
<div id="history"></div>
<script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.0.2/bignumber.min.js'></script>
<script>
  const S = 5; // 設定
  const M = 4; // モード
  const array = Array.from({ length: S }, () => Array.from({ length: M }, () => BigNumber(0)));
  const history = [];

  function onReset() {
    for (let s = 0; s < S; s++) {
      for (let m = 0; m < M-1; m++) {
        array[s][m] = BigNumber(1);
      }
    }
    history.splice(0);
    updateTable();
    updateHistory();
  }

  function apply(t) {
    history.push("replay");
    updateTable();
    updateHistory();
  }

  function onReplay() {
    // for (let s = 0; s < S; s++) {
    //   for (let m = 0; m < M; m++) {
    //     array[s][m] = array[s][m];
    //   }
    // }
    apply("replay");
  }

  function onSuica() {
    history.push("suica");
    updateTable();
    updateHistory();
  }

  function onSuicaF() {
    history.push("suicaF");
    updateTable();
    updateHistory();
  }

  function onChance() {
    history.push("chance");
    updateTable();
    updateHistory();
  }

  function onCherry() {
    history.push("cherry");
    updateTable();
    updateHistory();
  }

  function onCherryF() {
    history.push("cherryF");
    updateTable();
    updateHistory();
  }

  // テーブルの更新
  function updateTable() {
    // テーブルをクリア
    const headers = ["", "設定1", "設定2", "設定4", "設定5", "設定6"];    
    const table = document.getElementById("table");
    table.innerHTML = "";
    // ヘッダーを作成
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headers.forEach(headerText => {
      const th = document.createElement("th");
      th.textContent = headerText;
      headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);
    // 表内容を作成
    contents = Array.from({ length: 4 }, () => Array.from({ length: 6 }, () => ""));
    contents[0][0] = "地獄";
    contents[1][0] = "通常";
    contents[2][0] = "天国";
    contents[3][0] = "本前兆";
    for (let s = 0; s < S; s++) {
      let sum = BigNumber(0);
      for (let m = 0; m < M; m++) {
        sum = sum.plus(array[s][m]);
      }
      for (let m = 0; m < M; m++) {
        if (sum==0) {
          contents[m][s+1] = "0 %";
        } else {
          const p = array[s][m].dividedBy(sum).times(100).toFixed(2)
          contents[m][s+1] = p + "%";
        }
      }
    }
    // テーブルの更新
    const tbody = document.createElement("tbody");
    for (y = 0; y < 4; y++) {
      const tr = document.createElement("tr");
      for (x = 0; x < 6; x++) {
        const td = document.createElement("td");
        td.textContent = contents[y][x];
        tr.appendChild(td);
      }
      tbody.appendChild(tr);
    }
    table.appendChild(tbody);
  }

  function updateHistory() {
    // 履歴をクリア  
    const historyElm = document.getElementById("history");
    historyElm.innerHTML = "";
    // 履歴を作成
    for (i = 0; i < history.length; i++) {
      const h = history[history.length - i - 1];
      const div = document.createElement("div");
      div.textContent = h;
      div.classList.add(h);
      historyElm.appendChild(div);
    }
  }

  document.addEventListener("DOMContentLoaded", function() {
    updateTable();
  });
</script>
</body>
</html>