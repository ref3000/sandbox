<!DOCTYPE html>
<html>
<head>
<title>番長0</title>
<meta name="viewport" content="width=320,user-scalable=no">
<style>
  html, body, div, span, button {
    margin: 0;
    padding: 0;
  }
  header{
    background: rgb(255, 197, 197);
    position: fixed;
    width: 320px;
    height: 30px;
  }
  span {
    display: inline-block;
    text-align: center;
  }
  .rt {
    width: 13px;
    margin-top: 5px;
    font-size: 12px;
  }
  .result {
    width: 34px;
    margin-top: 5px;
    font-size: 12px;
    font-weight: bold;
  }
  .header-back {
    height: 30px;
  }
  .tile {
    width: 320px;
    height: 40px;
    white-space: nowrap;
  }
  .title {
    font-size: 16px;
    width: 160px;
    height: 40px;
    line-height: 40px;
    vertical-align: top;
  }
  .inc-button {
    width: 40px;
    height: 40px;
    font-size: 30px;
    -webkit-appearance: none;
  }
  .dec-button {
    width: 40px;
    height: 40px;
    font-size: 30px;
    -webkit-appearance: none;
  }
  .count {
    font-size: 30px;
    width: 72px;
    -webkit-appearance: none;
    -moz-appearance: textfield;
    text-align: center;
    border-radius: 0;
  }
</style>
</head>
<body>
<script src='https://cdn.jsdelivr.net/npm/bignumber.js@9.0.2/bignumber.min.js'></script>
<script>
  BigNumber.config({ POW_PRECISION: 100 });
  var data = [		
	["直撃確率",0,0,0,0,0,0,"#ffffff"],
	["直撃","0.000211999152","0.000237998905","0.000406008932","0.000623986023","0.000823994726","0.001018018935","#ffffee"],
	["その他","0.999788000848","0.999762001095","0.999593991068","0.999376013977","0.999176005274","0.998981981065","#eeeeee"],
	["ガチャ",0,0,0,0,0,0,"#ffffff"],
	["発見","0.475000000000","0.377000000000","0.463000000000","0.366000000000","0.582000000000","0.355000000000","#eeffff"],
	["偶然","0.475000000000","0.566000000000","0.463000000000","0.550000000000","0.314000000000","0.533000000000","#eeffff"],
	["高値","0.050000000000","0.050000000000","0.075000000000","0.075000000000","0.100000000000","0.100000000000","#eeffff"],
	["246","0.000000000000","0.007000000000","0.000000000000","0.007000000000","0.000000000000","0.007000000000","#eeffff"],
	["456","0.000000000000","0.000000000000","0.000000000000","0.002000000000","0.002000000000","0.002000000000","#eeffff"],
	["555","0.000000000000","0.000000000000","0.000000000000","0.000000000000","0.002000000000","0.002000000000","#eeffff"],
	["666","0.000000000000","0.000000000000","0.000000000000","0.000000000000","0.000000000000","0.001000000000","#eeffff"],
	["246（光無し）","0.000000000000","1.000000000000","0.000000000000","0.500000000000","0.000000000000","0.250000000000","#eeffff"],
	["456（光無し）","0.000000000000","0.000000000000","0.000000000000","0.500000000000","0.500000000000","0.250000000000","#eeffff"],
	["555（光無し）","0.000000000000","0.000000000000","0.000000000000","0.000000000000","0.500000000000","0.250000000000","#eeffff"],
	["666（光無し）","0.000000000000","0.000000000000","0.000000000000","0.000000000000","0.000000000000","0.250000000000","#eeffff"],
	["モード移行",0,0,0,0,0,0,"#ffffff"],
	["ZERO→通常","0.753900000000","0.734400000000","0.656300000000","0.640600000000","0.550800000000","0.496100000000","#ffeeff"],
	["ZERO→チャンス","0.121100000000","0.125000000000","0.156300000000","0.156300000000","0.199200000000","0.203100000000","#ffeeff"],
	["ZERO→ZERO","0.125000000000","0.140600000000","0.187500000000","0.203100000000","0.250000000000","0.300800000000","#ffeeff"],
	["通常→通常","0.753900000000","0.750000000000","0.687500000000","0.687500000000","0.625000000000","0.546900000000","#ffeeff"],
	["通常→チャンス","0.246100000000","0.250000000000","0.312500000000","0.312500000000","0.375000000000","0.453100000000","#ffeeff"],
	["チャンス→通常","0.628900000000","0.625000000000","0.617200000000","0.609400000000","0.578100000000","0.500000000000","#ffeeff"],
	["チャンス→チャンス","0.371100000000","0.375000000000","0.382800000000","0.390600000000","0.421900000000","0.500000000000","#ffeeff"],
  ]
  var c = [];
  var memo = new Map();
  function dec(i) {
    if (c[i] < 1) return
    c[i]--
    update()
  }
  function inc(i) {
    c[i]++
    update()
  }
  function set(i, v) {
    if (v < 0) return
    c[i] = v
    update()
  }
  function pow(i, j, c) {
    var key = i + ":" + j + ":" + c;
    if (!memo[key]) memo[key] = BigNumber(data[i][j]).pow(c);
    return memo[key];
  }
  function update() {
    for (i = 0; i < data.length; i++) {
      var elm = document.getElementById("c" + i)
      elm.value = c[i]
      // localStorage.setItem('c' + i, c[i]);
    }

    var p = [BigNumber(1), BigNumber(1), BigNumber(1), BigNumber(1), BigNumber(1), BigNumber(1)];
    for (i = 0; i < data.length; i++) {
      if (c[i] < 1) continue;
      for (j = 0; j < 6; j++) {
        p[j] = p[j].times(pow(i, j+1, c[i]))
      }
    }
    
    var sum = BigNumber(0);
    for (i = 0; i < 6; i++) sum = sum.plus(p[i]);
    for (i = 0; i < 6; i++) {
      document.getElementById("r" + (i+1)).textContent = Math.round(p[i].dividedBy(sum).times(1000))/10+"%";
    }

    var hash = "";
    for (i = 0; i < c.length; i++) hash+=c[i]+",";
    window.location.hash = hash;
  }
  window.onload = function() {
    var area = document.getElementById("area");
    for (i = 0; i < data.length; i++) {
      var tile = document.createElement("div");
      tile.className = "tile";
      if (data[i][7]) tile.style = "background-color: " + data[i][7];
      var t = document.createElement("span");
      t.id = "t" + i;
      t.className = "title";
      t.textContent = data[i][0];
      var db = document.createElement("button");
      db.id = "db" + i;
      db.className = "dec-button";
      db.onclick = function(e) { dec(e.target.id.slice(2) - 0) };
      db.textContent = "-";
      var ib = document.createElement("button");
      ib.id = "ib" + i;
      ib.className = "inc-button";
      ib.onclick = function(e) { inc(e.target.id.slice(2) - 0) };
      ib.textContent = "+";
      var count = document.createElement("input");
      count.id = "c" + i;
      count.className = "count";
      count.type = "text";
      count.inputMode = "numeric";
      count.onchange = function(e) { set(e.target.id.slice(1) - 0, e.target.value - 0) };
      tile.appendChild(t);
      if (!data[i][1]&&!data[i][2]&&!data[i][3]&&!data[i][4]&&!data[i][5]&&!data[i][6]) {
        count.style = "visibility:hidden";
      } else {
        tile.appendChild(db);
        tile.appendChild(ib);
      }
      tile.appendChild(count);
      area.appendChild(tile);
    }
    for (i = 0; i < data.length; i++) {
      // c[i] = localStorage.getItem('c' + i) || 0;
      c[i] = 0;
    }
    var hash = window.location.hash
    if (hash) {
      if (hash.substring(0, 1) === '#') hash = hash.slice(1);
      var toks = hash.split(',')
      for (i = 0; i < c.length; i++) {
        if (toks[i]) c[i] = toks[i] - 0;
      }
    }

    update()
  }
  function reset() {
    for (i = 0; i < data.length; i++) c[i] = 0;
    update();
  }
</script>
<header>
  <span class="rt">1:</span><span id="r1" class="result"></span>
  <span class="rt">2:</span><span id="r2" class="result"></span>
  <span class="rt">3:</span><span id="r3" class="result"></span>
  <span class="rt">4:</span><span id="r4" class="result"></span>
  <span class="rt">5:</span><span id="r5" class="result"></span>
  <span class="rt">6:</span><span id="r6" class="result"></span>
</header>
<div class="header-back"></div>
<div id="area">
</div>
<button onclick="reset()">全てリセット</button>
</body>
</html>
